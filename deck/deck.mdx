import {
  CodeSurfer,
  CodeSurferColumns,
  Step,
} from "code-surfer";
import { demo, code, deck } from "./theme";
import { Picture, Example, Layout } from './layout';

export const theme = deck;

<Layout>

# Remixing Constraint Validation

<div styles={{ textAlign: 'right '}}>Edmund Hung @ Remix Conf 2023</div>

</Layout>

---

<Layout>

## A browser mechanism for form validation

<center>#UseThePlatform</center>

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/1a" />

```jsx file=./01a.jsx title="HTML Form"
```

</Step>

<Step>

<Example src="./examples/1c" />

```jsx file=./01c.jsx title="Validation Attributes"
```

</Step>

</CodeSurferColumns>

---


<Layout>

## 1. Disable default browser validation

</Layout>

---

<Layout>

### Default validation flow

<Picture src="/assets/01-default-validation-flow.png" />

</Layout>

---

<Layout>

### Enhanced validation flow

<Picture src="/assets/02-enhanced-validation-flow.png" />

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/1c" />

```jsx file=./01c.jsx title="Previous example"
```

</Step>

<Step>

<Example src="./examples/2a" />

```jsx file=./02a.jsx title="Disable default brower validation"
```

</Step>

<Step>

<Example src="./examples/2b" />

```jsx file=./02b.jsx title="Re-implement form validation with reportValidty"
```

</Step>

</CodeSurferColumns>

---

<Layout>

### The `validity` property and `setCustomValidity` method

</Layout>

---

<Layout>

### New validation flow with error customized

<Picture src="/assets/03-updated-validation-flow.png" />

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/2b" />

```jsx file=./02b.jsx title="Previous example"
```

</Step>

<Step>

<Example src="./examples/3a" />

```jsx file=./03a.jsx title="Customizing messages with setCustomValidity"
```

</Step>

<Step>

<Example src="./examples/3c" />

```jsx file=./03c.jsx title="Derives message based on the ValidityState"
```

</Step>

</CodeSurferColumns>

---

<Layout>

### The invalid event

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/3c" />

```jsx file=./03c.jsx title="Previous example"
```

</Step>

<Step>

<Example src="./examples/4a" />

```jsx 35,40:49 file=./04a.jsx title="Capturing messages through invalid event"
```

</Step>

<Step>

<Example src="./examples/4b" />

```jsx file=./04b.jsx title="Displaying error next to the input"
```

</Step>

<Step>

<Example src="./examples/4c" />

```jsx file=./04c.jsx title="Clearing error before reporting"
```

</Step>

<Step>

<Example src="./examples/4c" />

```diff 34:67 title="Finish"
```

</Step>

</CodeSurferColumns>

---

<Layout>

### Final validation flow with error captured

<Picture src="/assets/04-final-validation-flow.png" />

</Layout>

---

<Layout>

## How about the server?

</Layout>

---

<Layout>

## ðŸ”¥ Introducing: @conform-to/validitystate

- A package for you to validate on the server with the ValidityState 
- Type inference support
- 0kb on the client. You need it only on the server

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/4c" />

```jsx 68:99 file=./04c.jsx
```

</Step>

<Step>

<Example src="./examples/5a" />

```jsx 90,99,108 file=./05a.jsx title="Extract the constraint of each form control as the schema"
```
</Step>

<Step>

<Example src="./examples/5a" />

```diff 4:19 title="Extract the constraint of each form control as the schema"
```
</Step>

<Step>

<Example src="./examples/5b" />

```jsx 1 file=./05b.jsx title="Import the parse helper"
```

</Step>

<Step>

<Example src="./examples/5b" />

```diff 54:66 title="Parse formData based on the schema"
```

</Step>

<Step>

<Example src="./examples/5c" />

```jsx 69:77 file=./05c.jsx title="Sync error with the client"
```

</Step>

</CodeSurferColumns>

---

<Layout>

## Summary

</Layout>

---

<Layout>

## Learn more

https://edmund.dev/blog/remixing-constraint-validation

@_edmundhung

</Layout>
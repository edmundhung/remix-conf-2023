import {
  CodeSurfer,
  CodeSurferColumns,
  Step,
} from "code-surfer";
import { demo, code, code2, deck } from "./theme";
import { Picture, Example, Layout } from './layout';

export const theme = deck;

<Layout>

# Remixing Constraint Validation

</Layout>

---

<Layout>

## A browser mechanism for form validation

<center>#UseThePlatform</center>

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/1a" />

```jsx file=./01a.jsx title="HTML Form"
```

</Step>

<Step>

<Example src="./examples/1b" />

```diff 10 title="Validation Attributes"
```

</Step>

<Step>

<Example src="./examples/1b" />

```jsx 8:12,16:22,26:30 file=./01b.jsx title="Validation Attributes"
```

</Step>

</CodeSurferColumns>

---


<Layout>

## Disable browser validation

</Layout>

---

<Layout>

### Enhancing the validation flow

<Picture src="/assets/enhanced-validation-flow.png" />

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/1b" />

```jsx file=./01b.jsx
```

</Step>

<Step>

<Example src="./examples/2a" />

```jsx file=./02a.jsx title="Disable default brower validation"
```

</Step>

<Step>

<Example src="./examples/2b" />

```jsx file=./02b.jsx title="Then re-enable it using form.reportValidty()"
```

</Step>

</CodeSurferColumns>

---

<CodeSurferColumns themes={[code2, code]} sizes={[1,2]}>

<Step>

```ts title="The error interface"
interface HTMLInputElement {
  validationMessage: string; 
  setCustomValidity(error: string): void;
  validity: ValidityState;
}
```

```jsx


```

</Step>

<Step>

```diff 2,3 title="The error interface"
```

```jsx title="validationMessage & setCustomValidity(message)"
const [input] = docuemnt.getElements.byTagName('input');

// The browser error message on error bubble
console.log(input.validationMessage);

// Override the message
input.setCustomValidity('This is invalid');

// It prints "This is invalid" now
console.log(input.validationMessage);
```

</Step>

<Step>

```diff 4 title="The error interface"
```

```jsx title="ValidityState"
{
  "badInput": false,
  "customError": false,
  "patternMismatch": false,
  "rangeOverflow": false,
  "rangeUnderflow": false,
  "stepMismatch": false,
  "tooLong": false,
  "tooShort": false,
  "typeMismatch": false,
  "valid": true,
  "valueMissing": false
}
```

</Step>

<Step>

```diff 4 title="The error interface"
```

```jsx title="ValidityState"
{
  "badInput": false,
  "customError": false,
  "patternMismatch": false,
  "rangeOverflow": false,
  "rangeUnderflow": false,
  "stepMismatch": false,
  "tooLong": false,
  "tooShort": false,
  "typeMismatch": false,
  "valid": false,
  "valueMissing": true
}
```

</Step>

</CodeSurferColumns>

---

<Layout title="New validation flow with error customized">

<Picture src="/assets/updated-validation-flow.png" />

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/2b" />

```jsx file=./02b.jsx
```

</Step>

<Step>

<Example src="./examples/3a" />

```jsx file=./03a.jsx title="Customizing messages with setCustomValidity"
```

</Step>

<Step>

<Example src="./examples/3b" />

```jsx file=./03b.jsx title="Derives message based on the ValidityState"
```

</Step>

</CodeSurferColumns>

---

<Layout title="The invalid event">

<Picture src="/assets/the-invalid-event.png" />

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/3b" />

```jsx file=./03b.jsx
```

</Step>

<Step>

<Example src="./examples/4a" />

```jsx 35,40:49,60 file=./04a.jsx title="Capturing messages through invalid event"
```

</Step>

<Step>

<Example src="./examples/4b" />

```jsx file=./04b.jsx title="Displaying error next to the input"
```

</Step>

</CodeSurferColumns>

---

<Layout title="Final validation flow with error captured">

<Picture src="/assets/final-validation-flow.png" />

</Layout>

---

<Layout>

## How about the server?

</Layout>

---

<Layout>

### ðŸ”¥ Introducing @conform-to/validitystate

- A package for you to validate on the server with the ValidityState 
- Type inference support
- 0kb on the client. You need it only on the server

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/4b" />

```jsx 68:99 file=./04b.jsx
```

</Step>

<Step>

<Example src="./examples/5a" />

```jsx 90,99,108 file=./05a.jsx title="Extract the constraint of each form control as the schema"
```
</Step>

<Step>

<Example src="./examples/5a" />

```diff 4:19 title="Extract the constraint of each form control as the schema"
```
</Step>

<Step>

<Example src="./examples/5b" />

```jsx 1 file=./05b.jsx title="Import the parse helper"
```

</Step>

<Step>

<Example src="./examples/5b" />

```diff 54:66 title="Parse formData based on the schema"
```

</Step>

<Step>

<Example src="./examples/5c" />

```jsx 69:77 file=./05c.jsx title="Sync error with the client"
```

</Step>

</CodeSurferColumns>

---

<Layout>

## It's just "The Web"

</Layout>

---

<Layout>

## Learn more

https://edmund.dev/blog/remixing-constraint-validation

@_edmundhung

</Layout>
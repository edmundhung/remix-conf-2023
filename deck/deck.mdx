import {
  CodeSurfer,
  CodeSurferColumns,
  Step,
} from "code-surfer";
import { demo, code, deck } from "./theme";
import { Example, Layout } from './layout';

export const theme = deck;

<Layout>

# Remixing Constraint Validation

Remix Conf 2023

</Layout>

---

<Layout>

## The Constraint Validation API

A specification that spread across HTML, CSS and the DOM.

</Layout>

---

<CodeSurfer theme={code}>

```jsx title="Validation Attributes"


```

```jsx title="Validation Attributes"
<input required />
```

```jsx title="Validation Attributes"
<input required />

<input type="number" min={0} max={5} step={0.5} />
```

```jsx title="Validation Attributes"
<input required />

<input type="number" min={0} max={5} step={0.5} />

<input type="email" pattern="[^@]+@example.com" />
```

```jsx title="Validation Attributes"
<input required />

<input type="number" min={0} max={5} step={0.5} />

<input type="email" pattern="[^@]+@example.com" />

<textarea minLength={10} maxLength={100}>
```

</CodeSurfer>

---

<CodeSurfer theme={code}>

```jsx title="ValidityState"


```

```jsx title="ValidityState"
<input
  onChange={(event) => {
    const input = event.currentTarget;

    console.log(input.validity);
  }}
/>
```

```json title="ValidityState"
{
  "badInput": false,
  "customError": false,
  "patternMismatch": false,
  "rangeOverflow": false,
  "rangeUnderflow": false,
  "stepMismatch": false,
  "tooLong": false,
  "tooShort": false,
  "typeMismatch": false,
  "valid": true,
  "valueMissing": false
}
```

```json title="ValidityState" subtitle="When a required input is empty"
{
  "badInput": false,
  "customError": false,
  "patternMismatch": false,
  "rangeOverflow": false,
  "rangeUnderflow": false,
  "stepMismatch": false,
  "tooLong": false,
  "tooShort": false,
  "typeMismatch": false,
  "valid": false,
  "valueMissing": true
}
```

</CodeSurfer>

---

<CodeSurfer theme={code}>

```jsx title="noValidate"


```

```jsx title="noValidate"
<form
  noValidate
/>
```

```jsx title="noValidate"
<form
  onSubmit={event => {
    const form = event.currentTarget;

    if (!form.reportValidity()) {
      event.preventDefault();
    }
  }}
  noValidate
/>
```

</CodeSurfer>

---

<CodeSurfer theme={code}>

```jsx title="The invalid event"


```

```jsx title="The invalid event"
<input
  onInvalid={event => {
    const input = event.currentTarget;

    // input.validity.valueMissing
    // input.validity.typeMismatch

    event.preventDefault();
  }}
/>
```

</CodeSurfer>

---

<Layout>

## A Remix Recipe

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[2,3]}>

<Step>

<Example src="./examples/basic" />

```jsx file=./01.BaseExample.jsx
```

</Step>

<Step subtitle="Prepare a state that manages error message of each field">

<Example src="./examples/error" />

```jsx file=./02.Preparation.jsx
```

</Step>

<Step subtitle="Capturing validation message with the invalid event">

<Example src="./examples/invalid-event" />

```jsx file=./03.ReportingErrors.jsx
```

</Step>

<Step subtitle="Ensuring messages are reset before reporting new errors">

<Example src="./examples/novalidate" />

```jsx file=./04.EnhancingValidation.jsx
```

</Step>

<Step subtitle="Customizing messages with the validity state">

<Example src="./examples/validitystate" />

```jsx file=./05.CustomizeMessages.jsx
```

</Step>

<Step subtitle="Processing the form data on action">

<Example src="./examples/nojs" />

```jsx file=./06.Action.jsx
```

</Step>

</CodeSurferColumns>

---

<Layout>

# Never trust the client

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[2,3]}>

<Step>

<Example src="./examples/nojs" />

```jsx 49:69 file=./06.Action.jsx
```

</Step>

<Step subtitle="Extract schema">

<Example src="./examples/final" />

```jsx 68,77 file=./07.ExtractSchema.jsx
```
</Step>

<Step subtitle="Extract schema">

<Example src="./examples/final" />

```diff 5:15
```
</Step>

<Step subtitle="The secret sauce">

<Example src="./examples/final" />

```jsx 1 file=./08.SecretSauce.jsx
```

</Step>

<Step subtitle="Parse formdata with the schema">

<Example src="./examples/final" />

```diff 31:43
```

</Step>

<Step subtitle="Ensure client errors are synced with server">

<Example src="./examples/final" />

```jsx file=./09.SyncState.jsx
```

</Step>

</CodeSurferColumns>

---

<Layout>

# Learn more

https://edmund.dev/blog/remixing-constraint-validation

@_edmundhung

</Layout>
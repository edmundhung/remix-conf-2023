import {
  CodeSurferColumns,
  Step,
} from "code-surfer";
import { demo, code, code2, deck } from "./theme";
import { Picture, Example, Layout } from './layout';

export const theme = deck;

<Layout>

# Remixing Constraint Validation

</Layout>

---

<Layout>

## A browser mechanism for form validation

<center>#UseThePlatform</center>

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/html-form" />

```jsx file=./src/html-form.jsx title="HTML Form"
```

</Step>

<Step>

<Example src="./examples/html-form" />

```diff 10 title="Validation Attributes"
```

</Step>

<Step>

<Example src="./examples/validation-attributes" />

```jsx 8:12,16:22,26:30 file=./src/validation-attributes.jsx title="Validation Attributes"
```

</Step>

</CodeSurferColumns>

---


<Layout>

## Disable default browser validation

</Layout>

---

<Layout title="Enhancing the validation flow">

<Picture src="/assets/enhanced-validation-flow.png" />

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/validation-attributes" />

```jsx file=./src/validation-attributes.jsx
```

</Step>

<Step>

<Example src="./examples/disable-browser-validation" />

```jsx file=./src/disable-browser-validation.jsx title="Disable default brower validation"
```

</Step>

<Step>

<Example src="./examples/reimplement-browser-validation" />

```jsx file=./src/reimplement-browser-validation.jsx title="Reimplement using form.reportValidity()"
```

</Step>

<Step>

<Example src="./examples/reimplement-browser-validation" />

```diff 10:12 title="Reimplement using form.reportValidity()"
```

</Step>

</CodeSurferColumns>

---

<CodeSurferColumns themes={[code2, code]} sizes={[1,2]}>

<Step>

```ts title="The error interface"
interface HTMLInputElement {
  validationMessage: string; 
  setCustomValidity(error: string): void;
  validity: ValidityState;
}
```

```jsx


```

</Step>

<Step>

```diff 2,3 title="The error interface"
```

```jsx title="Validation message"
const [input] = document.getElementsByTagName('input');

// Check message on error bubble
console.log(input.validationMessage);

// Override message
input.setCustomValidity('This is invalid');

// See updated message
console.log(input.validationMessage);
```

</Step>

<Step>

```diff 4 title="The error interface"
```

```jsx title="ValidityState"
{
  "badInput": false,
  "customError": false,
  "patternMismatch": false, // pattern
  "rangeOverflow": false,   // max
  "rangeUnderflow": false,  // min
  "stepMismatch": false,    // step
  "tooLong": false,         // maxlength
  "tooShort": false,        // minlength
  "typeMismatch": false,    // type
  "valid": true,
  "valueMissing": false     // required
}
```

</Step>

</CodeSurferColumns>

---

<Layout title="New validation flow with error customized">

<Picture src="/assets/updated-validation-flow.png" />

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/reimplement-browser-validation" />

```jsx file=./src/reimplement-browser-validation.jsx
```

</Step>

<Step>

<Example src="./examples/customize-messages" />

```jsx file=./src/customize-messages.jsx title="Customize messages with setCustomValidity"
```

</Step>

<Step>

<Example src="./examples/derive-messages" />

```jsx file=./src/derive-messages.jsx title="Derive messages based on ValidityState"
```

</Step>

</CodeSurferColumns>

---

<Layout title="Validation flow with error synchronized">

<Picture src="/assets/final-validation-flow.png" />

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/derive-messages" />

```jsx file=./src/derive-messages.jsx
```

</Step>

<Step>

<Example src="./examples/synchronize-messages" />

```jsx 35,40:49,60 file=./src/synchronize-messages.jsx title="Synchronize messages through invalid event"
```

</Step>

<Step>

<Example src="./examples/display-error" />

```jsx file=./src/display-error.jsx title="Display error next to the input"
```

</Step>

</CodeSurferColumns>

---

<Layout>

## How about the server?

</Layout>

---

<Layout>

### ðŸ”¥ Introducing @conform-to/validitystate

- A package for you to perform server validation based on ValidityState
- Type inference support
- 0 kb on the client

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/display-error" />

```jsx 68:99 file=./src/display-error.jsx
```

</Step>

<Step>

<Example src="./examples/extract-constraints" />

```jsx 90,99,108 file=./src/extract-constraints.jsx title="Extract constraints of each form control"
```
</Step>

<Step>

<Example src="./examples/extract-constraints" />

```diff 4:19 title="Extract constraints of each form control"
```
</Step>

<Step>

<Example src="./examples/parse-formdata" />

```jsx 1 file=./src/parse-formdata.jsx title="Parse formData based on schema"
```

</Step>

<Step>

<Example src="./examples/parse-formdata" />

```diff 54:66 title="Parse formData based on schema"
```

</Step>

<Step>

<Example src="./examples/synchronize-server-error" />

```jsx 69:77 file=./src/synchronize-server-error.jsx title="Synchronize error with client error state"
```

</Step>

</CodeSurferColumns>

---

<Layout>

## It's just "The Web"

</Layout>

---

<Layout>

## Thank You

https://edmund.dev/blog/remixing-constraint-validation

@_edmundhung

</Layout>
import {
  CodeSurfer,
  CodeSurferColumns,
  Step,
} from "code-surfer";
import { demo, code, code2, deck } from "./theme";
import { Picture, Example, Layout } from './layout';

export const theme = deck;

<Layout>

# Remixing Constraint Validation

</Layout>

---

<Layout>

## A browser mechanism for form validation

<center>#UseThePlatform</center>

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/1a" />

```jsx file=./01a.jsx title="HTML Form"
```

</Step>

<Step>

<Example src="./examples/1b" />

```diff 10 title="Validation Attributes"
```

</Step>

<Step>

<Example src="./examples/1b" />

```jsx 8:12,16:22,26:30 file=./01b.jsx title="Validation Attributes"
```

</Step>

</CodeSurferColumns>

---


<Layout>

## Disable default browser validation

</Layout>

---

<Layout title="Enhancing the validation flow">

<Picture src="/assets/enhanced-validation-flow.png" />

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/1b" />

```jsx file=./01b.jsx
```

</Step>

<Step>

<Example src="./examples/2a" />

```jsx file=./02a.jsx title="Disable default brower validation"
```

</Step>

<Step>

<Example src="./examples/2b" />

```jsx file=./02b.jsx title="Reimplement using form.reportValidity()"
```

</Step>

<Step>

<Example src="./examples/2b" />

```diff 10:12 title="Reimplement using form.reportValidity()"
```

</Step>

</CodeSurferColumns>

---

<CodeSurferColumns themes={[code2, code]} sizes={[1,2]}>

<Step>

```ts title="The error interface"
interface HTMLInputElement {
  validationMessage: string; 
  setCustomValidity(error: string): void;
  validity: ValidityState;
}
```

```jsx


```

</Step>

<Step>

```diff 2,3 title="The error interface"
```

```jsx title="Validation message"
const [input] = document.getElementsByTagName('input');

// Check message on error bubble
console.log(input.validationMessage);

// Override message
input.setCustomValidity('This is invalid');

// See updated message
console.log(input.validationMessage);
```

</Step>

<Step>

```diff 4 title="The error interface"
```

```jsx title="ValidityState"
{
  "badInput": false,
  "customError": false,
  "patternMismatch": false, // pattern
  "rangeOverflow": false,   // max
  "rangeUnderflow": false,  // min
  "stepMismatch": false,    // step
  "tooLong": false,         // maxlength
  "tooShort": false,        // minlength
  "typeMismatch": false,    // type
  "valid": true,
  "valueMissing": false     // required
}
```

</Step>

</CodeSurferColumns>

---

<Layout title="New validation flow with error customized">

<Picture src="/assets/updated-validation-flow.png" />

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/2b" />

```jsx file=./02b.jsx
```

</Step>

<Step>

<Example src="./examples/3a" />

```jsx file=./03a.jsx title="Customize messages with setCustomValidity"
```

</Step>

<Step>

<Example src="./examples/3b" />

```jsx file=./03b.jsx title="Derive messages based on ValidityState"
```

</Step>

</CodeSurferColumns>

---

<Layout title="Validation flow with error synchronized">

<Picture src="/assets/final-validation-flow.png" />

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/3b" />

```jsx file=./03b.jsx
```

</Step>

<Step>

<Example src="./examples/4a" />

```jsx 35,40:49,60 file=./04a.jsx title="Synchronize messages through invalid event"
```

</Step>

<Step>

<Example src="./examples/4b" />

```jsx file=./04b.jsx title="Display error next to the input"
```

</Step>

</CodeSurferColumns>

---

<Layout>

## How about the server?

</Layout>

---

<Layout>

### ðŸ”¥ Introducing @conform-to/validitystate

- A package for you to perform server validation based on ValidityState
- Type inference support
- 0 kb on the client

</Layout>

---

<CodeSurferColumns themes={[demo, code]} sizes={[1,2]}>

<Step>

<Example src="./examples/4b" />

```jsx 68:99 file=./04b.jsx
```

</Step>

<Step>

<Example src="./examples/5a" />

```jsx 90,99,108 file=./05a.jsx title="Extract constraints of each form control"
```
</Step>

<Step>

<Example src="./examples/5a" />

```diff 4:19 title="Extract constraints of each form control"
```
</Step>

<Step>

<Example src="./examples/5b" />

```jsx 1 file=./05b.jsx title="Import parse helper"
```

</Step>

<Step>

<Example src="./examples/5b" />

```diff 54:66 title="Parse formData based on schema"
```

</Step>

<Step>

<Example src="./examples/5c" />

```jsx 69:77 file=./05c.jsx title="Synchronize error with client error state"
```

</Step>

</CodeSurferColumns>

---

<Layout>

## It's just "The Web"

</Layout>

---

<Layout>

## Thank You

https://edmund.dev/blog/remixing-constraint-validation

@_edmundhung

</Layout>